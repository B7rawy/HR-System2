#!/bin/bash

# ุงุณูุฑูุจุช ุฅููุงู ูุธุงู ุงูุงุฎุชุจุงุฑ

echo "๐ ุฅููุงู ูุธุงู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ"
echo "============================"

# ูุฑุงุกุฉ ูุนุฑูุงุช ุงูุนูููุงุช
if [ -f ".pids" ]; then
    source .pids
    echo "๐ ูุนุฑูุงุช ุงูุนูููุงุช ุงููุญููุธุฉ:"
    echo "   Backend PID: $BACKEND_PID"
    echo "   Frontend PID: $FRONTEND_PID"
    
    # ุฅููุงู ุงูุนูููุงุช
    if [ ! -z "$BACKEND_PID" ]; then
        echo "๐ง ุฅููุงู ุงูุฎุงุฏู ุงูุฎููู..."
        kill $BACKEND_PID 2>/dev/null && echo "โ ุชู ุฅููุงู ุงูุฎุงุฏู ุงูุฎููู" || echo "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุนูููุฉ ุงูุฎุงุฏู ุงูุฎููู"
    fi
    
    if [ ! -z "$FRONTEND_PID" ]; then
        echo "๐จ ุฅููุงู ุงููุฑููุช ุฅูุฏ..."
        kill $FRONTEND_PID 2>/dev/null && echo "โ ุชู ุฅููุงู ุงููุฑููุช ุฅูุฏ" || echo "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุนูููุฉ ุงููุฑููุช ุฅูุฏ"
    fi
else
    echo "โ๏ธ ููู ูุนุฑูุงุช ุงูุนูููุงุช ุบูุฑ ููุฌูุฏ"
fi

# ุฅููุงู ุฌููุน ุงูุนูููุงุช ุงููุฑุชุจุทุฉ
echo "๐งน ุชูุธูู ุงูุนูููุงุช ุงููุชุจููุฉ..."
pkill -f "node.*server.js" 2>/dev/null && echo "โ ุชู ุฅููุงู ุฎูุงุฏู Node.js" || true
pkill -f "npm.*start" 2>/dev/null && echo "โ ุชู ุฅููุงู ุนูููุงุช npm" || true
pkill -f "react-scripts" 2>/dev/null && echo "โ ุชู ุฅููุงู React scripts" || true

# ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ
echo "๐๏ธ ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ..."
rm -f .pids
rm -f backend.log
rm -f frontend.log

# ุงูุชุญูู ูู ุฅููุงู ุงูููุงูุฐ
echo "๐ ุงูุชุญูู ูู ุงูููุงูุฐ..."
if lsof -ti:5001 > /dev/null 2>&1; then
    echo "โ๏ธ ุงููููุฐ 5001 ูุง ูุฒุงู ูุณุชุฎุฏูุงู"
    lsof -ti:5001 | xargs kill -9 2>/dev/null && echo "โ ุชู ุชุญุฑูุฑ ุงููููุฐ 5001" || true
else
    echo "โ ุงููููุฐ 5001 ูุชุงุญ"
fi

if lsof -ti:3000 > /dev/null 2>&1; then
    echo "โ๏ธ ุงููููุฐ 3000 ูุง ูุฒุงู ูุณุชุฎุฏูุงู"
    lsof -ti:3000 | xargs kill -9 2>/dev/null && echo "โ ุชู ุชุญุฑูุฑ ุงููููุฐ 3000" || true
else
    echo "โ ุงููููุฐ 3000 ูุชุงุญ"
fi

echo ""
echo "โ ุชู ุฅููุงู ุงููุธุงู ุจูุฌุงุญ!"
echo "========================"
echo ""
echo "๐ ูุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู:"
echo "   ./start-test-system.sh"
echo ""
echo "๐งช ูุงุฎุชุจุงุฑ ุณุฑูุน ูู WhatsApp:"
echo "   ./test-whatsapp.sh"
echo "" 