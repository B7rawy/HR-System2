# حل مشكلة المصادقة (401 Unauthorized)

## المشكلة
تظهر أخطاء 401 Unauthorized عند محاولة الوصول للواجهات البرمجية:
```
GET http://localhost:5001/api/employees/payment-history/2025-06 401 (Unauthorized)
GET http://localhost:5001/api/clients 401 (Unauthorized)
```

## السبب
التوكن (Token) المحفوظ في المتصفح إما:
- منتهي الصلاحية (مدة صلاحية التوكن 24 ساعة)
- غير صالح
- مفقود

## الحلول

### 1. الحل السريع ⚡
1. اذهب إلى: `http://localhost:3000/login`
2. استخدم بيانات المدير:
   - **اسم المستخدم:** `admin`
   - **كلمة المرور:** `admin123`
3. أو اضغط زر **"دخول سريع كمدير"**

### 2. حل المشكلة يدوياً 🔧
1. شغل الأمر:
   ```bash
   node backend/generate-token.js
   ```
2. انسخ التوكن المولد
3. اذهب إلى Developer Tools (اضغط F12)
4. اذهب إلى تبويب **Application** > **Local Storage**
5. أضف/عدّل المفتاح `token` مع القيمة الجديدة
6. أضف أيضاً مفتاح `user` مع القيمة:
   ```json
   {"id":"507f1f77bcf86cd799439011","username":"admin","role":"admin","email":"admin@company.com"}
   ```

### 3. حل تلقائي عبر API 🤖
1. اذهب إلى: `http://localhost:5001/api/auth/generate-demo-token`
2. انسخ التوكن من الاستجابة
3. احفظه في Local Storage كما هو موضح أعلاه

## التحقق من تشغيل الخوادم

### فحص الخوادم:
```bash
# فحص حالة المشكلة
node fix-auth-issue.js
```

### تشغيل النظام:
```bash
# الطريقة السريعة
start-system.bat

# أو يدوياً
cd backend && npm start
cd frontend && npm start
```

## ملاحظات مهمة ⚠️
- هذه مشكلة طبيعية تحدث عند انتهاء صلاحية التوكن
- صلاحية التوكن: 24 ساعة
- النظام سيعيد توجيهك تلقائياً لصفحة تسجيل الدخول عند انتهاء الصلاحية
- بعد تسجيل الدخول الجديد، كل شيء سيعمل طبيعياً

## اختبار الحل ✅
بعد تطبيق أي من الحلول أعلاه:
1. أعد تحميل الصفحة
2. جرب الوصول لأي صفحة في النظام
3. يجب أن تختفي أخطاء 401 Unauthorized

---
*تاريخ الإنشاء: 2025-06-20* 