# إدارة قاعدة البيانات - نظام الموارد البشرية

## المشكلة التي تم حلها ✅

**المشكلة**: كانت قاعدة البيانات تتم إعادة تعيينها وحذف البيانات في كل مرة يتم إعادة تشغيل الخادم.

**السبب**: ملف `initDB.js` كان يحتوي على أوامر حذف البيانات:
- `await User.deleteOne({ username: 'admin' });`
- `await Employee.deleteMany({});`

**الحل**: تم تعديل `initDB.js` ليتحقق من وجود البيانات قبل إنشائها، بدلاً من حذفها وإعادة إنشائها.

## كيفية عمل النظام الآن 🔧

### 1. التشغيل العادي
```bash
cd backend
npm run dev
```
- يتحقق من وجود مستخدم admin
- يتحقق من وجود موظفين
- ينشئ البيانات الأساسية فقط إذا لم تكن موجودة
- **لا يحذف أي بيانات موجودة**

### 2. إعادة تعيين قاعدة البيانات (يدوياً فقط)
```bash
cd backend
npm run reset
```
- يحذف جميع البيانات
- ينشئ مستخدم admin جديد
- ينشئ التصنيفات الأساسية
- **استخدم هذا فقط عند الحاجة لبداية جديدة**

### 3. إضافة بيانات تجريبية
```bash
cd backend
npm run seed
```
- يضيف موظفين تجريبيين
- **تحذير**: يحذف البيانات الموجودة

## الملفات المعدلة 📝

### `backend/initDB.js`
- ✅ تم تعديله ليتحقق من وجود البيانات
- ✅ لا يحذف البيانات الموجودة
- ✅ ينشئ البيانات الأساسية فقط عند الحاجة

### `backend/resetDatabase.js` (جديد)
- ✅ ملف منفصل لإعادة تعيين قاعدة البيانات
- ✅ يستخدم فقط عند الحاجة
- ✅ يعطي تحذير قبل الحذف

### `backend/package.json`
- ✅ تم إضافة سكريبت `npm run reset`

## التحقق من حالة قاعدة البيانات 🔍

عند تشغيل الخادم، ستظهر رسائل مثل:
```
✅ مستخدم admin موجود بالفعل
✅ يوجد 5 موظف في قاعدة البيانات بالفعل
📊 إحصائيات قاعدة البيانات:
👤 عدد المستخدمين: 1
👥 عدد الموظفين: 5
```

## بيانات تسجيل الدخول 🔑

```
Username: admin
Password: admin123
```

## نصائح مهمة ⚠️

1. **لا تستخدم** `npm run seed` إلا إذا كنت تريد حذف البيانات الموجودة
2. **استخدم** `npm run reset` فقط عند الحاجة لبداية جديدة تماماً
3. **التشغيل العادي** بـ `npm run dev` آمن ولا يحذف البيانات
4. **احتفظ بنسخة احتياطية** من قاعدة البيانات قبل استخدام أي أمر حذف

## استكشاف الأخطاء 🔧

### إذا فقدت البيانات:
1. تحقق من أنك لم تستخدم `npm run seed` أو `npm run reset`
2. تحقق من اتصال قاعدة البيانات
3. راجع سجلات الخادم للتأكد من عدم وجود أخطاء

### إذا لم تظهر البيانات الأساسية:
1. أعد تشغيل الخادم
2. تحقق من اتصال MongoDB Atlas
3. تحقق من صحة متغيرات البيئة

## الخلاصة ✨

تم حل مشكلة حذف البيانات عند إعادة تشغيل الخادم. الآن النظام:
- ✅ يحافظ على البيانات الموجودة
- ✅ ينشئ البيانات الأساسية عند الحاجة فقط
- ✅ يوفر خيارات منفصلة لإعادة التعيين
- ✅ آمن للاستخدام اليومي 